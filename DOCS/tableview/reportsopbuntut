CREATE OR REPLACE VIEW report_sopbuntut AS
SELECT
    a.no_pkk,
    p.id,
    a.vessel_name,
    a.nama_perusahaan,
    a.vessel_type,
    a.draught,
    a.dimension_to_bow,
    a.dimension_to_stern,
    a.dimension_to_port,
    a.dimension_to_starboard,
    a.bendera,
    a.tgl_tiba,
    a.pelabuhan_asal,
    a.lokasi_lambat_labuh,
    a.tgl_brangkat,
    a.pelabuhan_tujuan,
    g.geofence_id,
    g.in,
    g.out,
    g.total_time,
    p.created_at
FROM
    ais_data_positions p
    LEFT JOIN ais_data_vessels a ON p.vessel_id = a.id
    LEFT JOIN report_geofences g ON p.id = g.ais_data_position_id
WHERE
    DATE(p.created_at) = CURDATE()
ORDER BY
    p.id DESC;
