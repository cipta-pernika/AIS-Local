L.TrackPlayBackControl=L.Control.extend({includes:L.Evented?L.Evented.prototype:L.Mixin.Events,options:{position:"bottomleft",showOptions:!0,showInfo:!0,showSlider:!0,autoPlay:!1,trackPointOptions:!0,trackLineOptions:!0},initialize:function(trackplayback,options){L.Control.prototype.initialize.call(this,options),this.trackPlayBack=trackplayback,this.trackPlayBack.on("tick",this._tickCallback,this)},onAdd:function(map){return this._initContainer(),this._container},onRemove:function(map){this.trackPlayBack.dispose(),this.trackPlayBack.off("tick",this._tickCallback,this)},getTimeStrFromUnix:function(time,accuracy="s"){time=parseInt(1e3*time);let newDate=new Date(time),year=newDate.getFullYear(),month=newDate.getMonth()+1<10?"0"+(newDate.getMonth()+1):newDate.getMonth()+1,day=newDate.getDate()<10?"0"+newDate.getDate():newDate.getDate(),hours=newDate.getHours()<10?"0"+newDate.getHours():newDate.getHours(),minuts=newDate.getMinutes()<10?"0"+newDate.getMinutes():newDate.getMinutes(),seconds=newDate.getSeconds()<10?"0"+newDate.getSeconds():newDate.getSeconds(),ret;return ret="d"===accuracy?year+"-"+month+"-"+day:"h"===accuracy?year+"-"+month+"-"+day+" "+hours:"m"===accuracy?year+"-"+month+"-"+day+" "+hours+":"+minuts:year+"-"+month+"-"+day+" "+hours+":"+minuts+":"+seconds,ret},_initContainer:function(){var className="leaflet-control-playback";return this._container=L.DomUtil.create("div",className),this._container.setAttribute("id","leaflet-control-playback"),L.DomEvent.disableClickPropagation(this._container),this._buttonContainer=this._createContainer("buttonContainer",this._container),this._sliderContainer=this._createContainer("sliderContainer",this._container),this._optionsContainer=this._createContainer("optionsContainer",this._container),this._infoContainer=this._createContainer("infoContainer",this._container),this._infoCurTime=this._createInfo("curTime: ",this.getTimeStrFromUnix(this.trackPlayBack.getCurTime()),"info-cur-time",this._sliderContainer),this._slider=this._createSlider("time-slider",this._sliderContainer,this._scrollchange),this._infoEndTime=this._createInfo("endTime: ",this.getTimeStrFromUnix(this.trackPlayBack.getEndTime()),"info-end-time",this._sliderContainer),this._playBtn=this._createButton("play","btn-stop",this._buttonContainer,this._play),this._restartBtn=this._createButton("replay","btn-restart",this._buttonContainer,this._restart),this._slowSpeedBtn=this._createButton("slow","btn-slow",this._buttonContainer,this._slow),this._infoSpeedRatio=this._createInfo("",`X${this.trackPlayBack.getSpeed()}`,"info-speed-ratio",this._buttonContainer),this._quickSpeedBtn=this._createButton("quick","btn-quick",this._buttonContainer,this._quick),this._closeBtn=this._createButton("close","btn-close",this._buttonContainer,this._close),this._container},_createContainer:function(className,container){return L.DomUtil.create("div",className,container)},_createCheckbox:function(labelName,className,container,fn){let divEle=L.DomUtil.create("div",className+" trackplayback-checkbox",container),inputEle=L.DomUtil.create("input","trackplayback-input",divEle),inputId=`trackplayback-input-${L.Util.stamp(inputEle)}`;inputEle.setAttribute("type","checkbox"),inputEle.setAttribute("id",inputId);let labelEle=L.DomUtil.create("label","trackplayback-label",divEle);return labelEle.setAttribute("for",inputId),labelEle.innerHTML=labelName,L.DomEvent.on(inputEle,"change",fn,this),divEle},_createButton:function(title,className,container,fn){let link=L.DomUtil.create("a",className,container);return link.href="#",link.title=title,link.setAttribute("role","button"),link.setAttribute("aria-label",title),L.DomEvent.disableClickPropagation(link),L.DomEvent.on(link,"click",fn,this),link},_createInfo:function(title,info,className,container){let infoContainer=L.DomUtil.create("div","info-container",container),infoEle=L.DomUtil.create("a",className,infoContainer);return infoEle.innerHTML=info,infoEle},_createSlider:function(className,container,fn){let sliderEle=L.DomUtil.create("input",className,container);return sliderEle.setAttribute("type","range"),sliderEle.setAttribute("min",this.trackPlayBack.getStartTime()),sliderEle.setAttribute("max",this.trackPlayBack.getEndTime()),sliderEle.setAttribute("value",this.trackPlayBack.getCurTime()),L.DomEvent.on(sliderEle,"click mousedown dbclick",L.DomEvent.stopPropagation).on(sliderEle,"click",L.DomEvent.preventDefault).on(sliderEle,"change",fn,this).on(sliderEle,"mousemove",fn,this),sliderEle},_showTrackPoint(e){e.target.checked?this.trackPlayBack.showTrackPoint():this.trackPlayBack.hideTrackPoint()},_showTrackLine(e){e.target.checked?this.trackPlayBack.showTrackLine():this.trackPlayBack.hideTrackLine()},_play:function(){let hasClass;L.DomUtil.hasClass(this._playBtn,"btn-stop")?(L.DomUtil.removeClass(this._playBtn,"btn-stop"),L.DomUtil.addClass(this._playBtn,"btn-start"),this._playBtn.setAttribute("title","stop"),this.trackPlayBack.start()):(L.DomUtil.removeClass(this._playBtn,"btn-start"),L.DomUtil.addClass(this._playBtn,"btn-stop"),this._playBtn.setAttribute("title","play"),this.trackPlayBack.stop())},_restart:function(){L.DomUtil.removeClass(this._playBtn,"btn-stop"),L.DomUtil.addClass(this._playBtn,"btn-start"),this._playBtn.setAttribute("title","stop"),this.trackPlayBack.rePlaying()},_slow:function(){this.trackPlayBack.slowSpeed();let sp=this.trackPlayBack.getSpeed();this._infoSpeedRatio.innerHTML=`X${sp}`},_quick:function(){this.trackPlayBack.quickSpeed();let sp=this.trackPlayBack.getSpeed();this._infoSpeedRatio.innerHTML=`X${sp}`},_close:function(){return L.DomUtil.remove(this._container),this.onRemove&&this.onRemove(this._map),this},_scrollchange:function(e){let val=Number(e.target.value);this.trackPlayBack.setCursor(val)},_tickCallback:function(e){let time=this.getTimeStrFromUnix(e.time);this._infoCurTime.innerHTML=time,this._slider.value=e.time,e.time>=this.trackPlayBack.getEndTime()&&(L.DomUtil.removeClass(this._playBtn,"btn-start"),L.DomUtil.addClass(this._playBtn,"btn-stop"),this._playBtn.setAttribute("title","play"),this.trackPlayBack.stop())}}),L.trackplaybackcontrol=function(trackplayback,options){return new L.TrackPlayBackControl(trackplayback,options)};